---
title: "Ethnicity in OpenSAFELY-TPP: A short data report"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
## Import libraries
library('here')
library('tidyverse')
library('gtsummary')
library('kableExtra')
library('knitr')

```

# All Patients ever registered
## Category

```{r full_SNOMED, echo=FALSE}
read_rds(here("output", "tables", "full_SNOMED.rds"))
```

## Category compared

```{r full_ethnicity_compare, echo=FALSE}
theme_gtsummary_compact()
read_rds(here("output", "tables", "full_ethnicity_compare.rds"))
```

```{r full_compare, echo=FALSE}
theme_gtsummary_compact()
read_rds(here("output", "tables", "full_compare.rds"))
```


## Missingness

```{r full_missing, echo=FALSE}
read_rds(here("output", "tables", "full_missing.rds"))
```

  
## Missingness comparison

```{r full_missing_compare, echo=FALSE}
read_rds(here("output", "tables", "full_missing_compare.rds"))
```

## Latest ethnicity vs most common ethnicity
#### I need to think how to deal with ties for most common ethnicity
```{r matches, echo=FALSE}
read_rds(here("output", "tables", "matches.rds"))
```


#### expanded
```{r matches_expanded, echo=FALSE}
read_rds(here("output", "tables", "matches_expanded.rds"))
```

## ONS Comparison
```{r ons_region, echo=FALSE}
  include_graphics(here("output", "plots", "ethnicity_count.png"))
```

## State changes
```{r alluvium, echo=FALSE}
  include_graphics(here("output", "plots", "alluvium.png"))
```


# Patients registered as of 2022/01/01 


```{r reg_SNOMED, echo=FALSE}
read_rds(here::here("output", "tables", "reg_SNOMED.rds"))
```

## Category compared

```{r reg_ethnicity_compare, echo=FALSE}
theme_gtsummary_compact()
read_rds(here("output", "tables", "reg_ethnicity_compare.rds"))
```

## Missingness

```{r reg_missing, echo=FALSE}
read_rds(here("output", "tables", "reg_missing.rds"))
```

  
## Missingness comparison

```{r reg_missing_compare, echo=FALSE}
read_rds(here("output", "tables", "reg_missing_compare.rds"))
```


