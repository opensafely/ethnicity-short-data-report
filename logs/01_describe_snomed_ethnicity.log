-------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/lsh152058/Desktop/GitHub/ethnicity-short-
> data-report/logs/01_describe_snomed_ethnicity.log
  log type:  text
 opened on:   7 Sep 2021, 10:14:40

. 
. *create stata version of codelists for merging
. import delimited ./codelists/opensafely-ethnicity-uk-catego
> ries.csv, clear
(2 vars, 610 obs)

. format code %20.0f

. tostring code, gen(snomedcode) format(%20.0g)
snomedcode generated as str16

. save ./output/opensafely-ethnicity-uk-categories_formerge.d
> ta, replace
file ./output/opensafely-ethnicity-uk-categories_formerge.dta
>  saved

. 
. clear

. 
. *import csv for each group and save as dta
. forvalues i=2/10 {
  2.          import delimited ./output/input_`i'.csv, clear
  3.          gen group=`i'
  4.         save ./output/input`i'.dta, replace
  5. }
(66 vars, 1,000 obs)
file ./output/input2.dta saved
(66 vars, 1,000 obs)
file ./output/input3.dta saved
(66 vars, 1,000 obs)
file ./output/input4.dta saved
(66 vars, 1,000 obs)
file ./output/input5.dta saved
(66 vars, 1,000 obs)
file ./output/input6.dta saved
(66 vars, 1,000 obs)
file ./output/input7.dta saved
(66 vars, 1,000 obs)
file ./output/input8.dta saved
(66 vars, 1,000 obs)
file ./output/input9.dta saved
(66 vars, 1,000 obs)
file ./output/input10.dta saved

. 
. *append all 10 files
. import delimited using ./output/input.csv, clear
(66 vars, 1,000 obs)

. gen group=1

. forvalues i=2/10 {
  2.          append using ./output/input`i'.dta
  3. }
(note: variable age was byte, now int to accommodate using
       data's values)

. 
. 
. order patient_id

. tab group

      group |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,000       10.00       10.00
          2 |      1,000       10.00       20.00
          3 |      1,000       10.00       30.00
          4 |      1,000       10.00       40.00
          5 |      1,000       10.00       50.00
          6 |      1,000       10.00       60.00
          7 |      1,000       10.00       70.00
          8 |      1,000       10.00       80.00
          9 |      1,000       10.00       90.00
         10 |      1,000       10.00      100.00
------------+-----------------------------------
      Total |     10,000      100.00

. *collapse count of each ethnicity code 
. collapse (sum) eth_* 

. 
. *reshape long
. gen ethnicity=1

. reshape long eth_, i(ethnicity) j(snomedcode)
(note: j = 286009 1340002 1451003 1919006 2688009 2720008 285
> 2001 3353005 3698008 3818007 4073004 4299001 6373008 769500
> 5 8124001 9158000 9533000 10008004 10117001 10292001 104320
> 01 11794009 12556008 13233008 13440006 14045001 14176005 14
> 470009 14999008 15086000 15801006 17095009 17789004 1816700
> 9 18575005 18583004 18664001 19085009 19434008 20140003 202
> 91009 20449009 21047009 21868006 21993009 22007004 23517005
>  23534002 23922002 24812003 25750005 25804004 26215007 2730
> 1002 27683006 27700004 28409002 28562006 28796001 28821007 
> 29343004 31637002 32045009 32513008 32873005 33182009 33897
> 005 34334001 35007000 36329002 37474002 37843006 38144004 3
> 8361009 38750003 39007007 39764005 40165009 40182006 410760
> 03 41798002 42632009 43056000 43608005 43890005 44460002 45
> 465003 46110004 46723002 47250000 47327008 48118002 4829400
> 8 48375000 48393004 48679001 49202008 50405005 51750002 518
> 27000 52075006 53195006 53460002 55990000 56056003 57405008
>  57539009 58047002 59366001 59487007 59597001 60157000 6259
> 8008 63457007 63732001 63736003 64483007 64693008 65776006 
> 66406004 66920001 67165000 67439005 67931002 68486007 69865
> 008 69983001 71176007 71949006 72201005 72248007 72337002 7
> 2809004 73524008 73736004 74159009 74302004 75301003 753260
> 07 75704009 76253004 76460008 76574004 76768002 76775001 76
> 883002 77502007 77686000 79434006 80208004 80528001 8103500
> 8 81283004 81403004 81560001 81653003 81846005 82174001 833
> 65001 83584002 83939006 85163001 85371009 85515006 86275006
>  87323008 88790004 88839008 88934004 89026003 90027003 9034
> 8007 90822005 91066000 91191002 91488008 108342005 11316900
> 9 113170005 113171009 139955009 139960008 154159009 1541600
> 04 154161000 154162007 154163002 154164008 154165009 154166
> 005 154167001 154168006 154169003 154170002 154171003 15417
> 2005 154173000 154174006 154175007 154176008 154177004 1541
> 78009 154179001 154180003 154181004 154182006 154183001 154
> 184007 154185008 154186009 154187000 154188005 154189002 15
> 4190006 154191005 154192003 154193008 154194002 154195001 1
> 54196000 154197009 154198004 154199007 154200005 154201009 
> 154202002 154203007 154204001 154205000 154206004 154207008
>  154208003 154209006 154210001 154211002 154212009 15421300
> 4 154214005 154215006 154216007 154217003 154218008 1542190
> 00 154220006 154221005 154222003 154223008 154224002 154225
> 001 154226000 154227009 154229007 160531006 162730000 16273
> 1001 162732008 162734009 162735005 185983003 185984009 1859
> 85005 185986006 185987002 185988007 185989004 185990008 185
> 991007 185992000 185993005 185994004 185995003 185996002 18
> 5997006 185998001 185999009 186000006 186001005 186002003 1
> 86003008 186004002 186005001 186006000 186007009 186008004 
> 186009007 186010002 186011003 186012005 186013000 186014006
>  186015007 186016008 186017004 186018009 186019001 18602000
> 7 186021006 186022004 186023009 186024003 186025002 1860260
> 01 186027005 186028000 186029008 186030003 186031004 186032
> 006 186033001 186034007 186035008 186036009 186037000 18603
> 9002 186040000 186041001 186042008 186043003 186044009 1860
> 45005 186046006 186047002 186048007 268914005 270460000 270
> 461001 270462008 270463003 270464009 270465005 270466006 27
> 0467002 275586009 275587000 275588005 275589002 275590006 2
> 75591005 275592003 275593008 275594002 275595001 275596000 
> 275597009 275599007 275600005 275601009 275602002 309643000
>  309644006 312859007 312860002 312861003 315236000 31523700
> 9 315238004 315239007 315240009 315279003 315280000 3152810
> 01 315282008 315283003 315634007 315635008 364699009 365455
> 004 365456003 367505005 372148003 393199009 394149000 39463
> 5008 397607002 397731000 398089004 401213008 401214002 4134
> 65009 413466005 413569000 414152003 414551003 414661004 414
> 978006 443225003 445343003 704385002 704386001 704387005 70
> 4388000 704389008 704390004 704391000 704392007 718958002 7
> 18959005 718960000 718961001 718962008 718963003 718964009 
> 733078003 733446001 735001008 763726001 870448005 411210000
> 00107 43481000000100 44881000000100 44891000000103 77711000
> 000105 82121000000108 86461000000107 88911000000101 8892100
> 0000107 88931000000109 88941000000100 88951000000102 889610
> 00000104 88971000000106 88981000000108 88991000000105 89001
> 000000105 89011000000107 89021000000101 89031000000104 9238
> 1000000106 92391000000108 92401000000106 92411000000108 924
> 21000000102 92431000000100 92441000000109 92451000000107 92
> 461000000105 92471000000103 92481000000101 92491000000104 9
> 2501000000105 92511000000107 92521000000101 92531000000104 
> 92541000000108 92551000000106 92561000000109 92571000000102
>  92581000000100 92591000000103 92601000000109 9261100000010
> 6 92621000000100 92631000000103 92641000000107 926510000001
> 05 92661000000108 92671000000101 92681000000104 92691000000
> 102 92701000000102 92711000000100 92721000000106 9273100000
> 0108 92741000000104 92751000000101 92761000000103 927710000
> 00105 92781000000107 92791000000109 93921000000101 93931000
> 000104 93941000000108 93951000000106 93961000000109 9398100
> 0000100 93991000000103 94001000000108 94011000000105 940210
> 00000104 94031000000102 94041000000106 94051000000109 94061
> 000000107 94071000000100 94081000000103 94091000000101 9410
> 1000000109 94111000000106 94121000000100 94131000000103 941
> 41000000107 94151000000105 107691000000105 110401000000103 
> 110751000000108 110761000000106 110771000000104 11078100000
> 0102 110791000000100 110831000000107 202171000000101 207971
> 000000101 207981000000104 296841000000102 354441000000105 4
> 94131000000105 494161000000100 503391000000104 503401000000
> 101 503411000000104 518701000000103 518721000000107 5196810
> 00000108 583481000000105 583491000000107 591311000000105 59
> 2491000000104 592501000000105 651601000000100 6617310000001
> 07 661741000000103 666871000000107 668681000000107 71001100
> 0000101 718021000000105 718131000000106 723621000000103 728
> 721000000100 728731000000103 976551000000109 97657100000010
> 0 976591000000101 976611000000109 976631000000101 976651000
> 000108 976671000000104 976691000000100 976711000000103 9767
> 21000000109 976731000000106 976741000000102 976751000000104
>  976761000000101 976771000000108 976781000000105 9767910000
> 00107 976811000000108 976831000000100 976851000000107 97687
> 1000000103 976891000000104 976911000000101 976931000000109 
> 976951000000102 976961000000104 976971000000106 97698100000
> 0108 977351000000100 977371000000109 977391000000108 977401
> 000000106 977411000000108 977421000000102 977431000000100 9
> 77441000000109 977551000000106 977561000000109 977591000000
> 103 977711000000100 977731000000108 977751000000101 9777710
> 00000105 977791000000109 977811000000105 977831000000102 97
> 7851000000109 977861000000107 977871000000100 9778810000001
> 03 977911000000103 977931000000106 977951000000104 97797100
> 0000108 978011000000101 978031000000109 978041000000100 978
> 051000000102 978061000000104 978071000000106 97811100000010
> 0 978171000000105 978191000000109 978211000000108 978231000
> 000100 978251000000107 978271000000103 978341000000102 9783
> 61000000101 978381000000105 978391000000107 978401000000105
>  978411000000107 1024701000000100 1036211000000103 10362510
> 00000104 1036281000000105 1036301000000106 1036321000000102
>  1036341000000109 1036361000000105)

Data                               wide   ->   long
-------------------------------------------------------------
> ----------------
Number of obs.                        1   ->     610
Number of variables                 611   ->       3
j variable (610 values)                   ->   snomedcode
xij variables:
eth_286009 eth_1340002 ... eth_1036361000000105->eth_
-------------------------------------------------------------
> ----------------

. ren eth_ snomedcode_count

. 
. format snomedcode %20.0f

. tostring snomedcode, replace format(%20.0g)
snomedcode was double now str16

. 
. *merge with codelist for descriptors
. merge 1:1 snomedcode using ./output/opensafely-ethnicity-uk
> -categories_formerge.dta

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                               610  (_merge==3)
    -----------------------------------------

. 
. gen include=0

. replace include=1 if _merge==3
(610 real changes made)

. replace include=0 if snomedcode_count==0
(0 real changes made)

. tab include

    include |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        610      100.00      100.00
------------+-----------------------------------
      Total |        610      100.00

. drop code

. save ./output/snomed_ethnicity_counts.dta, replace
file ./output/snomed_ethnicity_counts.dta saved

. export delimited using ./output/snomed_ethnicity_counts.csv
> , replace
file ./output/snomed_ethnicity_counts.csv saved

. log close
      name:  <unnamed>
       log:  /Users/lsh152058/Desktop/GitHub/ethnicity-short-
> data-report/logs/01_describe_snomed_ethnicity.log
  log type:  text
 closed on:   7 Sep 2021, 10:14:50
-------------------------------------------------------------
