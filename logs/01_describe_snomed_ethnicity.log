-------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/lsh152058/Desktop/GitHub/ethnicity-short-
> data-report/logs/01_describe_snomed_ethnicity.log
  log type:  text
 opened on:   8 Sep 2021, 12:51:05

. 
. *create stata version of codelists for merging
. import delimited ./codelists/opensafely-ethnicity-uk-catego
> ries.csv, clear
(2 vars, 610 obs)

. format code %20.0f

. tostring code, gen(snomedcode) format(%20.0g)
snomedcode generated as str16

. save ./output/opensafely-ethnicity-uk-categories_formerge.d
> ta, replace
file ./output/opensafely-ethnicity-uk-categories_formerge.dta
>  saved

. 
. clear

. 
. *import csv for each group and save as dta
. import delimited using ./output/input.csv, clear
(66 vars, 1,000 obs)

. gen group=1

. save ./output/input1.dta, replace
file ./output/input1.dta saved

. 
. forvalues i=2/10 {
  2.          import delimited ./output/input_`i'.csv, clear
  3.          gen group=`i'
  4.         save ./output/input`i'.dta, replace
  5. }
(66 vars, 1,000 obs)
file ./output/input2.dta saved
(66 vars, 1,000 obs)
file ./output/input3.dta saved
(66 vars, 1,000 obs)
file ./output/input4.dta saved
(66 vars, 1,000 obs)
file ./output/input5.dta saved
(66 vars, 1,000 obs)
file ./output/input6.dta saved
(66 vars, 1,000 obs)
file ./output/input7.dta saved
(66 vars, 1,000 obs)
file ./output/input8.dta saved
(66 vars, 1,000 obs)
file ./output/input9.dta saved
(66 vars, 1,000 obs)
file ./output/input10.dta saved

. 
. forvalues i=1/10 {
  2.         use ./output/input`i'.dta, clear
  3.         
.         *collapse count of each ethnicity code 
.         collapse (sum) eth_* (min) group
  4. 
.         *reshape long
.         gen ethnicity=1
  5.         reshape long eth_ , i(ethnicity) j(snomedcode)
  6.         ren eth_ snomedcode_count
  7. 
.         format snomedcode %20.0f
  8.         tostring snomedcode, replace format(%20.0g)
  9. 
.         *merge with codelist for descriptors
.         merge 1:1 snomedcode using ./output/opensafely-ethn
> icity-uk-categories_formerge.dta, keep(match)
 10. 
.         gen include=0
 11.         replace include=1 if _merge==3
 12.         replace include=0 if snomedcode_count==0
 13.         tab include
 14.         drop code
 15.         save ./output/snomed_ethnicity_count_`i'.dta, re
> place
 16. }
(note: j = 1340002 1451003 10008004 10117001 10292001 1043200
> 1 11794009 12556008 13233008 13440006 14045001 14176005 144
> 70009 14999008 15086000 108342005 113169009 113170005 11317
> 1009 139955009 139960008 154159009 154160004 154161000 1541
> 62007 154163002 154164008 154165009 154166005 154167001 154
> 168006 154169003 154170002 154171003 154172005 154173000 15
> 4174006 154175007 154176008 154177004 154178009 154179001 1
> 54180003 154181004 154182006 107691000000105 11040100000010
> 3 110751000000108 110761000000106 110771000000104 110781000
> 000102 110791000000100 110831000000107 1024701000000100 103
> 6211000000103 1036251000000104 1036281000000105 10363010000
> 00106 1036321000000102 1036341000000109 1036361000000105)

Data                               wide   ->   long
-------------------------------------------------------------
> ----------------
Number of obs.                        1   ->      61
Number of variables                  63   ->       4
j variable (61 values)                    ->   snomedcode
xij variables:
eth_1340002 eth_1451003 ... eth_1036361000000105->eth_
-------------------------------------------------------------
> ----------------
snomedcode was double now str16

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                61  (_merge==3)
    -----------------------------------------
(61 real changes made)
(0 real changes made)

    include |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         61      100.00      100.00
------------+-----------------------------------
      Total |         61      100.00
file ./output/snomed_ethnicity_count_1.dta saved
(note: j = 15801006 17095009 17789004 18167009 18575005 18583
> 004 154183001 154184007 154185008 154186009 154187000 15418
> 8005 154189002 154190006 154191005 154192003 154193008 1541
> 94002 154195001 154196000 154197009 154198004 154199007 154
> 200005 154201009 154202002 154203007 154204001 154205000 15
> 4206004 154207008 154208003 154209006 154210001 154211002 1
> 54212009 154213004 154214005 154215006 154216007 154217003 
> 154218008 154219000 154220006 154221005 154222003 154223008
>  154224002 154225001 154226000 154227009 154229007 16053100
> 6 162730000 162731001 162732008 162734009 162735005 1859830
> 03 185984009 185985005)

Data                               wide   ->   long
-------------------------------------------------------------
> ----------------
Number of obs.                        1   ->      61
Number of variables                  63   ->       4
j variable (61 values)                    ->   snomedcode
xij variables:
eth_15801006 eth_17095009 ... eth_185985005->  eth_
-------------------------------------------------------------
> ----------------
snomedcode was long now str9
(note: variable snomedcode was str9, now str16 to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                61  (_merge==3)
    -----------------------------------------
(61 real changes made)
(0 real changes made)

    include |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         61      100.00      100.00
------------+-----------------------------------
      Total |         61      100.00
file ./output/snomed_ethnicity_count_2.dta saved
(note: j = 185986006 185987002 185988007 185989004 185990008 
> 185991007 185992000 185993005 185994004 185995003 185996002
>  185997006 185998001 185999009 186000006 186001005 18600200
> 3 186003008 186004002 186005001 186006000 186007009 1860080
> 04 186009007 186010002 186011003 186012005 186013000 186014
> 006 186015007 186016008 186017004 186018009 186019001 18602
> 0007 186021006 186022004 186023009 186024003 186025002 1860
> 26001 186027005 186028000 186029008 186030003 186031004 186
> 032006 186033001 186034007 186035008 186036009 186037000 18
> 6039002 186040000 186041001 186042008 186043003 186044009 1
> 86045005 186046006 186047002)

Data                               wide   ->   long
-------------------------------------------------------------
> ----------------
Number of obs.                        1   ->      61
Number of variables                  63   ->       4
j variable (61 values)                    ->   snomedcode
xij variables:
eth_185986006 eth_185987002 ... eth_186047002->eth_
-------------------------------------------------------------
> ----------------
snomedcode was long now str9
(note: variable snomedcode was str9, now str16 to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                61  (_merge==3)
    -----------------------------------------
(61 real changes made)
(0 real changes made)

    include |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         61      100.00      100.00
------------+-----------------------------------
      Total |         61      100.00
file ./output/snomed_ethnicity_count_3.dta saved
(note: j = 286009 1919006 2688009 2720008 2852001 18664001 19
> 085009 19434008 20140003 20291009 20449009 21047009 2186800
> 6 21993009 22007004 23517005 23534002 23922002 24812003 257
> 50005 25804004 26215007 27301002 27683006 27700004 28409002
>  28562006 28796001 28821007 29343004 186048007 268914005 27
> 0460000 270461001 270462008 270463003 270464009 270465005 2
> 70466006 270467002 275586009 275587000 275588005 275589002 
> 275590006 275591005 275592003 275593008 275594002 275595001
>  275596000 275597009 275599007 275600005 275601009 27560200
> 2 309643000 202171000000101 207971000000101 207981000000104
>  296841000000102)

Data                               wide   ->   long
-------------------------------------------------------------
> ----------------
Number of obs.                        1   ->      61
Number of variables                  63   ->       4
j variable (61 values)                    ->   snomedcode
xij variables:
eth_286009 eth_1919006 ... eth_296841000000102->eth_
-------------------------------------------------------------
> ----------------
snomedcode was double now str15
(note: variable snomedcode was str15, now str16 to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                61  (_merge==3)
    -----------------------------------------
(61 real changes made)
(0 real changes made)

    include |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         61      100.00      100.00
------------+-----------------------------------
      Total |         61      100.00
file ./output/snomed_ethnicity_count_4.dta saved
(note: j = 3353005 3698008 3818007 4073004 31637002 32045009 
> 32513008 32873005 33182009 33897005 34334001 35007000 36329
> 002 37474002 37843006 38144004 38361009 38750003 39007007 3
> 9764005 40165009 40182006 41076003 309644006 312859007 3128
> 60002 312861003 315236000 315237009 315238004 315239007 315
> 240009 315279003 315280000 315281001 315282008 315283003 31
> 5634007 315635008 364699009 365455004 365456003 367505005 3
> 72148003 393199009 394149000 394635008 397607002 397731000 
> 398089004 401213008 401214002 413465009 413466005 413569000
>  414152003 414551003 414661004 414978006 41121000000107 354
> 441000000105)

Data                               wide   ->   long
-------------------------------------------------------------
> ----------------
Number of obs.                        1   ->      61
Number of variables                  63   ->       4
j variable (61 values)                    ->   snomedcode
xij variables:
eth_3353005 eth_3698008 ... eth_354441000000105->eth_
-------------------------------------------------------------
> ----------------
snomedcode was double now str15
(note: variable snomedcode was str15, now str16 to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                61  (_merge==3)
    -----------------------------------------
(61 real changes made)
(0 real changes made)

    include |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         61      100.00      100.00
------------+-----------------------------------
      Total |         61      100.00
file ./output/snomed_ethnicity_count_5.dta saved
(note: j = 4299001 6373008 41798002 42632009 43056000 4360800
> 5 43890005 44460002 45465003 46110004 46723002 47250000 473
> 27008 48118002 48294008 48375000 48393004 48679001 49202008
>  50405005 51750002 51827000 52075006 53195006 53460002 5599
> 0000 56056003 57405008 57539009 58047002 59366001 59487007 
> 59597001 60157000 62598008 63457007 63732001 63736003 64483
> 007 64693008 65776006 443225003 445343003 43481000000100 44
> 881000000100 44891000000103 494131000000105 494161000000100
>  503391000000104 503401000000101 503411000000104 5187010000
> 00103 518721000000107 519681000000108 583481000000105 58349
> 1000000107 591311000000105 592491000000104 592501000000105 
> 651601000000100 661731000000107)

Data                               wide   ->   long
-------------------------------------------------------------
> ----------------
Number of obs.                        1   ->      61
Number of variables                  63   ->       4
j variable (61 values)                    ->   snomedcode
xij variables:
eth_4299001 eth_6373008 ... eth_661731000000107->eth_
-------------------------------------------------------------
> ----------------
snomedcode was double now str15
(note: variable snomedcode was str15, now str16 to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                61  (_merge==3)
    -----------------------------------------
(61 real changes made)
(0 real changes made)

    include |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         61      100.00      100.00
------------+-----------------------------------
      Total |         61      100.00
file ./output/snomed_ethnicity_count_6.dta saved
(note: j = 7695005 66406004 66920001 67165000 67439005 679310
> 02 68486007 69865008 69983001 71176007 71949006 72201005 72
> 248007 72337002 72809004 73524008 73736004 74159009 7430200
> 4 75301003 75326007 75704009 76253004 76460008 76574004 767
> 68002 76775001 76883002 77502007 77686000 79434006 80208004
>  704385002 704386001 704387005 704388000 704389008 70439000
> 4 704391000 704392007 718958002 718959005 718960000 7189610
> 01 718962008 718963003 718964009 733078003 733446001 735001
> 008 763726001 77711000000105 661741000000103 66687100000010
> 7 668681000000107 710011000000101 718021000000105 718131000
> 000106 723621000000103 728721000000100 728731000000103)

Data                               wide   ->   long
-------------------------------------------------------------
> ----------------
Number of obs.                        1   ->      61
Number of variables                  63   ->       4
j variable (61 values)                    ->   snomedcode
xij variables:
eth_7695005 eth_66406004 ... eth_728731000000103->eth_
-------------------------------------------------------------
> ----------------
snomedcode was double now str15
(note: variable snomedcode was str15, now str16 to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                61  (_merge==3)
    -----------------------------------------
(61 real changes made)
(0 real changes made)

    include |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         61      100.00      100.00
------------+-----------------------------------
      Total |         61      100.00
file ./output/snomed_ethnicity_count_7.dta saved
(note: j = 8124001 9158000 80528001 81035008 81283004 8140300
> 4 81560001 81653003 81846005 82174001 83365001 83584002 839
> 39006 85163001 85371009 85515006 86275006 87323008 88790004
>  88839008 88934004 89026003 90027003 90348007 90822005 9106
> 6000 91191002 91488008 870448005 82121000000108 86461000000
> 107 88911000000101 88921000000107 88931000000109 8894100000
> 0100 88951000000102 88961000000104 88971000000106 889810000
> 00108 88991000000105 89001000000105 89011000000107 89021000
> 000101 89031000000104 92381000000106 92391000000108 9240100
> 0000106 92411000000108 92421000000102 92431000000100 924410
> 00000109 92451000000107 92461000000105 92471000000103 92481
> 000000101 92491000000104 92501000000105 92511000000107 9252
> 1000000101 92531000000104 92541000000108)

Data                               wide   ->   long
-------------------------------------------------------------
> ----------------
Number of obs.                        1   ->      61
Number of variables                  63   ->       4
j variable (61 values)                    ->   snomedcode
xij variables:
eth_8124001 eth_9158000 ... eth_92541000000108->eth_
-------------------------------------------------------------
> ----------------
snomedcode was double now str14
(note: variable snomedcode was str14, now str16 to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                61  (_merge==3)
    -----------------------------------------
(61 real changes made)
(0 real changes made)

    include |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         61      100.00      100.00
------------+-----------------------------------
      Total |         61      100.00
file ./output/snomed_ethnicity_count_8.dta saved
(note: j = 9533000 92551000000106 92561000000109 925710000001
> 02 92581000000100 92591000000103 92601000000109 92611000000
> 106 92621000000100 92631000000103 92641000000107 9265100000
> 0105 92661000000108 92671000000101 92681000000104 926910000
> 00102 92701000000102 92711000000100 92721000000106 92731000
> 000108 92741000000104 92751000000101 92761000000103 9277100
> 0000105 92781000000107 92791000000109 93921000000101 939310
> 00000104 93941000000108 93951000000106 93961000000109 93981
> 000000100 93991000000103 94001000000108 94011000000105 9402
> 1000000104 94031000000102 94041000000106 94051000000109 940
> 61000000107 94071000000100 94081000000103 94091000000101 94
> 101000000109 94111000000106 94121000000100 94131000000103 9
> 4141000000107 94151000000105 976551000000109 97657100000010
> 0 976591000000101 976611000000109 976631000000101 976651000
> 000108 976671000000104 976691000000100 976711000000103 9767
> 21000000109 976731000000106 976741000000102)

Data                               wide   ->   long
-------------------------------------------------------------
> ----------------
Number of obs.                        1   ->      61
Number of variables                  63   ->       4
j variable (61 values)                    ->   snomedcode
xij variables:
eth_9533000 eth_92551000000106 ... eth_976741000000102->eth_
-------------------------------------------------------------
> ----------------
snomedcode was double now str15
(note: variable snomedcode was str15, now str16 to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                61  (_merge==3)
    -----------------------------------------
(61 real changes made)
(0 real changes made)

    include |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         61      100.00      100.00
------------+-----------------------------------
      Total |         61      100.00
file ./output/snomed_ethnicity_count_9.dta saved
(note: j = 976751000000104 976761000000101 976771000000108 97
> 6781000000105 976791000000107 976811000000108 9768310000001
> 00 976851000000107 976871000000103 976891000000104 97691100
> 0000101 976931000000109 976951000000102 976961000000104 976
> 971000000106 976981000000108 977351000000100 97737100000010
> 9 977391000000108 977401000000106 977411000000108 977421000
> 000102 977431000000100 977441000000109 977551000000106 9775
> 61000000109 977591000000103 977711000000100 977731000000108
>  977751000000101 977771000000105 977791000000109 9778110000
> 00105 977831000000102 977851000000109 977861000000107 97787
> 1000000100 977881000000103 977911000000103 977931000000106 
> 977951000000104 977971000000108 978011000000101 97803100000
> 0109 978041000000100 978051000000102 978061000000104 978071
> 000000106 978111000000100 978171000000105 978191000000109 9
> 78211000000108 978231000000100 978251000000107 978271000000
> 103 978341000000102 978361000000101 978381000000105 9783910
> 00000107 978401000000105 978411000000107)

Data                               wide   ->   long
-------------------------------------------------------------
> ----------------
Number of obs.                        1   ->      61
Number of variables                  63   ->       4
j variable (61 values)                    ->   snomedcode
xij variables:
eth_976751000000104 eth_976761000000101 ... eth_9784110000001
> 07->eth_
-------------------------------------------------------------
> ----------------
snomedcode was double now str15
(note: variable snomedcode was str15, now str16 to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                61  (_merge==3)
    -----------------------------------------
(61 real changes made)
(0 real changes made)

    include |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         61      100.00      100.00
------------+-----------------------------------
      Total |         61      100.00
file ./output/snomed_ethnicity_count_10.dta saved

. 
. *append all 10 files
. use ./output/snomed_ethnicity_count_1.dta

. forvalues i=2/10 {
  2.          append using ./output/snomed_ethnicity_count_`i
> '.dta
  3. }
(label _merge already defined)
(label _merge already defined)
(label _merge already defined)
(label _merge already defined)
(label _merge already defined)
(label _merge already defined)
(label _merge already defined)
(label _merge already defined)
(label _merge already defined)

. 
. gsort -include snomedcode

. 
. order snomedcode

. tab group

(min) group |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         61       10.00       10.00
          2 |         61       10.00       20.00
          3 |         61       10.00       30.00
          4 |         61       10.00       40.00
          5 |         61       10.00       50.00
          6 |         61       10.00       60.00
          7 |         61       10.00       70.00
          8 |         61       10.00       80.00
          9 |         61       10.00       90.00
         10 |         61       10.00      100.00
------------+-----------------------------------
      Total |        610      100.00

. export delimited using ./output/snomed_ethnicity_counts.csv
> , replace
file ./output/snomed_ethnicity_counts.csv saved

. log close
      name:  <unnamed>
       log:  /Users/lsh152058/Desktop/GitHub/ethnicity-short-
> data-report/logs/01_describe_snomed_ethnicity.log
  log type:  text
 closed on:   8 Sep 2021, 12:51:09
-------------------------------------------------------------
