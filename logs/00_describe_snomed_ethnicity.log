------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/lsh152058/Desktop/GitHub/ethnicity-short
> -data-report/logs/00_describe_snomed_ethnicity.log
  log type:  text
 opened on:  20 Jul 2021, 19:04:04

. 
. *create stata version of codelists for merginng
. import delimited ./codelists/opensafely-ethnicity-uk-categ
> ories_formerge.csv, clear
(3 vars, 598 obs)

. format snomedcode %20.0f

. tostring snomedcode, replace format(%20.0g)
snomedcode was double now str16

. save ./output/opensafely-ethnicity-uk-categories_formerge.
> dta, replace
file ./output/opensafely-ethnicity-uk-categories_formerge.dt
> a saved

. 
. clear

. import delimited ./output/input.csv
(604 vars, 1,000 obs)

. 
. 
. order patient_id

. 
. *collapse count of each ethincity code 
. collapse (sum) eth_*

. 
. *reshape long
. gen ethnicity=1

. reshape long eth_, i(ethnicity) j(snomedcode)
(note: j = 286009 1340002 1451003 1919006 2688009 2720008 28
> 52001 3353005 3698008 3818007 4073004 4299001 6373008 7695
> 005 8124001 9158000 9533000 10008004 10117001 10292001 104
> 32001 11794009 12556008 13233008 13440006 14045001 1417600
> 5 14470009 14999008 15086000 15801006 17095009 17789004 18
> 167009 18575005 18583004 18664001 19085009 19434008 201400
> 03 20291009 20449009 21047009 21868006 21993009 22007004 2
> 3517005 23534002 23922002 24812003 25750005 25804004 26215
> 007 27301002 27683006 27700004 28409002 28562006 28796001 
> 28821007 29343004 31637002 32045009 32513008 32873005 3318
> 2009 33897005 34334001 35007000 36329002 37474002 37843006
>  38144004 38361009 38750003 39007007 39764005 40165009 401
> 82006 41076003 41798002 42632009 43056000 43608005 4389000
> 5 44460002 45465003 46110004 46723002 47250000 47327008 48
> 118002 48294008 48375000 48393004 48679001 49202008 504050
> 05 51750002 51827000 52075006 53195006 53460002 55990000 5
> 6056003 57405008 57539009 58047002 59366001 59487007 59597
> 001 60157000 62598008 63457007 63732001 63736003 64483007 
> 64693008 65776006 66406004 66920001 67165000 67439005 6793
> 1002 68486007 69865008 69983001 71176007 71949006 72201005
>  72248007 72337002 72809004 73524008 73736004 74159009 743
> 02004 75301003 75326007 75704009 76253004 76460008 7657400
> 4 76768002 76775001 76883002 77502007 77686000 79434006 80
> 208004 80528001 81035008 81283004 81403004 81560001 816530
> 03 81846005 82174001 83365001 83584002 83939006 85163001 8
> 5371009 85515006 86275006 87323008 88790004 88839008 88934
> 004 89026003 90027003 90348007 90822005 91066000 91191002 
> 91488008 108342005 113169009 113170005 113171009 139955009
>  139960008 154159009 154160004 154161000 154162007 1541630
> 02 154164008 154165009 154166005 154167001 154168006 15416
> 9003 154170002 154171003 154172005 154173000 154174006 154
> 175007 154176008 154177004 154178009 154179001 154180003 1
> 54181004 154182006 154183001 154184007 154185008 154186009
>  154187000 154188005 154189002 154190006 154191005 1541920
> 03 154193008 154194002 154195001 154196000 154197009 15419
> 8004 154199007 154200005 154201009 154202002 154203007 154
> 204001 154205000 154206004 154207008 154208003 154209006 1
> 54210001 154211002 154212009 154213004 154214005 154215006
>  154216007 154217003 154218008 154219000 154220006 1542210
> 05 154222003 154223008 154224002 154225001 154226000 15422
> 7009 154229007 160531006 162730000 162731001 162732008 162
> 734009 162735005 185983003 185984009 185985005 185986006 1
> 85987002 185988007 185989004 185990008 185991007 185992000
>  185993005 185994004 185995003 185996002 185997006 1859980
> 01 185999009 186000006 186001005 186002003 186003008 18600
> 4002 186005001 186006000 186007009 186008004 186009007 186
> 010002 186011003 186012005 186013000 186014006 186015007 1
> 86016008 186017004 186018009 186019001 186020007 186021006
>  186022004 186023009 186024003 186025002 186026001 1860270
> 05 186028000 186029008 186030003 186031004 186032006 18603
> 3001 186034007 186035008 186036009 186037000 186039002 186
> 040000 186041001 186042008 186043003 186044009 186045005 1
> 86046006 186047002 186048007 268914005 270460000 270461001
>  270462008 270463003 270464009 270465005 270466006 2704670
> 02 275586009 275587000 275588005 275589002 275590006 27559
> 1005 275592003 275593008 275594002 275595001 275596000 275
> 597009 275599007 275600005 275601009 275602002 309643000 3
> 09644006 312859007 312860002 312861003 315236000 315237009
>  315238004 315239007 315240009 315279003 315280000 3152810
> 01 315282008 315283003 315634007 315635008 364699009 36545
> 5004 365456003 367505005 372148003 393199009 394149000 394
> 635008 397731000 398089004 401213008 401214002 413465009 4
> 13466005 413569000 414152003 414551003 414661004 414978006
>  445343003 704385002 704386001 704387005 704388000 7043890
> 08 704390004 704391000 704392007 718958002 718959005 71896
> 0000 718961001 718962008 718963003 718964009 733078003 733
> 446001 735001008 763726001 870448005 41121000000107 434810
> 00000100 44881000000100 44891000000103 77711000000105 8212
> 1000000108 86461000000107 88911000000101 88921000000107 88
> 931000000109 88941000000100 88951000000102 88961000000104 
> 88971000000106 88981000000108 88991000000105 8900100000010
> 5 89011000000107 89021000000101 89031000000104 92381000000
> 106 92391000000108 92401000000106 92411000000108 924210000
> 00102 92431000000100 92441000000109 92451000000107 9246100
> 0000105 92471000000103 92481000000101 92491000000104 92501
> 000000105 92511000000107 92521000000101 92531000000104 925
> 41000000108 92551000000106 92561000000109 92571000000102 9
> 2581000000100 92591000000103 92601000000109 92611000000106
>  92621000000100 92631000000103 92641000000107 926510000001
> 05 92661000000108 92671000000101 92681000000104 9269100000
> 0102 92701000000102 92711000000100 92721000000106 92731000
> 000108 92741000000104 92751000000101 92761000000103 927710
> 00000105 92781000000107 92791000000109 93921000000101 9393
> 1000000104 93941000000108 93951000000106 93961000000109 93
> 981000000100 93991000000103 94001000000108 94011000000105 
> 94021000000104 94031000000102 94041000000106 9405100000010
> 9 94061000000107 94071000000100 94081000000103 94091000000
> 101 94101000000109 94111000000106 94121000000100 941310000
> 00103 94141000000107 94151000000105 107691000000105 110401
> 000000103 110751000000108 110761000000106 110771000000104 
> 110781000000102 110791000000100 110831000000107 2968410000
> 00102 494131000000105 494161000000100 518701000000103 5187
> 21000000107 519681000000108 583481000000105 58349100000010
> 7 591311000000105 592491000000104 592501000000105 65160100
> 0000100 661731000000107 661741000000103 666871000000107 66
> 8681000000107 710011000000101 718021000000105 718131000000
> 106 976551000000109 976571000000100 976591000000101 976611
> 000000109 976631000000101 976651000000108 976671000000104 
> 976691000000100 976711000000103 976721000000109 9767310000
> 00106 976741000000102 976751000000104 976761000000101 9767
> 71000000108 976781000000105 976791000000107 97681100000010
> 8 976831000000100 976851000000107 976871000000103 97689100
> 0000104 976911000000101 976931000000109 976951000000102 97
> 6961000000104 976971000000106 976981000000108 977351000000
> 100 977371000000109 977391000000108 977401000000106 977411
> 000000108 977421000000102 977431000000100 977441000000109 
> 977551000000106 977561000000109 977591000000103 9777110000
> 00100 977731000000108 977751000000101 977771000000105 9777
> 91000000109 977811000000105 977831000000102 97785100000010
> 9 977861000000107 977871000000100 977881000000103 97791100
> 0000103 977931000000106 977951000000104 977971000000108 97
> 8011000000101 978031000000109 978041000000100 978051000000
> 102 978061000000104 978071000000106 978111000000100 978171
> 000000105 978191000000109 978211000000108 978231000000100 
> 978251000000107 978271000000103 978341000000102 9783610000
> 00101 978381000000105 978391000000107 978401000000105 9784
> 11000000107 1024701000000100 1036211000000103 103625100000
> 0104 1036281000000105 1036301000000106 1036321000000102 10
> 36341000000109 1036361000000105)

Data                               wide   ->   long
------------------------------------------------------------
> -----------------
Number of obs.                        1   ->     598
Number of variables                 599   ->       3
j variable (598 values)                   ->   snomedcode
xij variables:
eth_286009 eth_1340002 ... eth_1036361000000105->eth_
------------------------------------------------------------
> -----------------

. ren eth_ snomedcode_count

. 
. format snomedcode %20.0f

. tostring snomedcode, replace format(%20.0g)
snomedcode was double now str16

. 
. *merge with codelist for descriptors
. merge 1:1 snomedcode using ./output/opensafely-ethnicity-u
> k-categories_formerge.dta

    Result                           # of obs.
    -----------------------------------------
    not matched                            14
        from master                         7  (_merge==1)
        from using                          7  (_merge==2)

    matched                               591  (_merge==3)
    -----------------------------------------

. 
. gen include=0

. replace include=1 if _merge==3
(591 real changes made)

. replace include=0 if snomedcode_count==0
(0 real changes made)

. tab include

    include |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |         14        2.31        2.31
          1 |        591       97.69      100.00
------------+-----------------------------------
      Total |        605      100.00

. drop code

. save ./output/snomed_ethnicity_counts.dta, replace
file ./output/snomed_ethnicity_counts.dta saved

. 
. log close
      name:  <unnamed>
       log:  /Users/lsh152058/Desktop/GitHub/ethnicity-short
> -data-report/logs/00_describe_snomed_ethnicity.log
  log type:  text
 closed on:  20 Jul 2021, 19:04:09
------------------------------------------------------------
